<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Adjust an existing FastRet model for use with a new column — adjust_frm • FastRet</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adjust an existing FastRet model for use with a new column — adjust_frm"><meta name="description" content="The goal of this function is to train a model that predicts RT_ADJ (retention
time measured on a new, adjusted column) from RT (retention time measured on
the original column) and to attach this adjustment model to an existing
FastRet model."><meta property="og:description" content="The goal of this function is to train a model that predicts RT_ADJ (retention
time measured on a new, adjusted column) from RT (retention time measured on
the original column) and to attach this adjustment model to an existing
FastRet model."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FastRet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/GUI-Usage.html">GUI Usage</a></li>
    <li><a class="dropdown-item" href="../articles/CLI-Usage.html">CLI Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Package-Internals.html">Package Internals</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/Installation.html">Installation</a></li>
    <li><a class="dropdown-item" href="../articles/Old-Intro.html">Old Introduction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/spang-lab/FastRet/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adjust an existing FastRet model for use with a new column</h1>
      <small class="dont-index">Source: <a href="https://github.com/spang-lab/FastRet/blob/main/R/train.R" class="external-link"><code>R/train.R</code></a></small>
      <div class="d-none name"><code>adjust_frm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The goal of this function is to train a model that predicts RT_ADJ (retention
time measured on a new, adjusted column) from RT (retention time measured on
the original column) and to attach this adjustment model to an existing
FastRet model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">adjust_frm</span><span class="op">(</span></span>
<span>  <span class="va">frm</span>,</span>
<span>  <span class="va">new_data</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>  nfolds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  do_cv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  adj_type <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>  add_cds <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-frm">frm<a class="anchor" aria-label="anchor" href="#arg-frm"></a></dt>
<dd><p>An object of class <code>frm</code> as returned by <code><a href="train_frm.html">train_frm()</a></code>.</p></dd>


<dt id="arg-new-data">new_data<a class="anchor" aria-label="anchor" href="#arg-new-data"></a></dt>
<dd><p>Data frame with required columns "RT", "NAME", "SMILES"; optional "INCHIKEY".
"RT" must be the retention time measured on the adjusted column.
Each row must match at least one row in <code>frm$df</code>.
The exact matching behavior is described in 'Details'.</p></dd>


<dt id="arg-predictors">predictors<a class="anchor" aria-label="anchor" href="#arg-predictors"></a></dt>
<dd><p>Numeric vector specifying which transformations to include in the model.
Available options are: 1=RT, 2=RT^2, 3=RT^3, 4=log(RT), 5=exp(RT),
6=sqrt(RT). Note that predictor 1 (RT) is always included, even if not
specified explicitly.</p></dd>


<dt id="arg-nfolds">nfolds<a class="anchor" aria-label="anchor" href="#arg-nfolds"></a></dt>
<dd><p>The number of folds for cross validation.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Show progress messages?</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An integer value to set the seed for random number generation to allow for
reproducible results.</p></dd>


<dt id="arg-do-cv">do_cv<a class="anchor" aria-label="anchor" href="#arg-do-cv"></a></dt>
<dd><p>A logical value indicating whether to perform cross-validation. If FALSE,
the <code>cv</code> element in the returned adjustment object will be NULL.</p></dd>


<dt id="arg-adj-type">adj_type<a class="anchor" aria-label="anchor" href="#arg-adj-type"></a></dt>
<dd><p>A string representing the adjustment model type. Either "lm", "lasso",
"ridge", or "gbtree".</p></dd>


<dt id="arg-add-cds">add_cds<a class="anchor" aria-label="anchor" href="#arg-add-cds"></a></dt>
<dd><p>A logical value indicating whether to add chemical descriptors as predictors
to new data. Default is TRUE if <code>adj_type</code> is "lasso", "ridge" or "gbtree"
and FALSE if <code>adj_type</code> is "lm".</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>frm</code>, as returned by <code><a href="train_frm.html">train_frm()</a></code>, but with an
additional element <code>adj</code> containing the adjustment model. Components of <code>adj</code>
are:</p><ul><li><p><code>model</code>: The fitted adjustment model. Class depends on <code>adj_type</code> and is
one of <code>lm</code>, <code>glmnet</code>, or <code>xgb.Booster</code>.</p></li>
<li><p><code>df</code>: The data frame used for training the adjustment model. Including
columns "NAME", "SMILES", "RT", "RT_ADJ" and optionally "INCHIKEY", as well
as any additional predictors specified via the <code>predictors</code> argument.</p></li>
<li><p><code>cv</code>: A named list containing the cross validation results (see 'Details'),
or NULL if <code>do_cv = FALSE</code>. When not NULL, elements are:</p><ul><li><p><code>folds</code>: A list of integer vectors specifying the samples in each fold.</p></li>
<li><p><code>models</code>: A list of adjustment models trained on each fold.</p></li>
<li><p><code>stats</code>: A list of vectors with RMSE, Rsquared, MAE, pBelow1Min per fold.
Added with v1.3.0.</p></li>
<li><p><code>preds</code>: Retention time predictions obtained during CV by applying the
adjustment model to the hold-out data.</p></li>
<li><p><code>preds_adjonly</code>: Removed (i.e. NULL) since v1.3.0.</p></li>
</ul></li>
<li><p><code>args</code>: Function arguments used for adjustment (excluding <code>frm</code>, <code>new_data</code>
and <code>verbose</code>). Added with v1.3.0.</p></li>
<li><p><code>version</code>: The version of the FastRet package used to train the adjustment
model. Added with v1.3.0.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Matching is done via "SMILES"+"INCHIKEY" if both datasets have non-missing
INCHIKEYs for all rows; otherwise via "SMILES"+"NAME". If multiple rows in
<code>frm$df</code> match the same row in <code>new_data</code>, their RT values are averaged
first, and this average is used for training the adjustment model.</p>
<p>Example: if <code>frm$df</code> equals data.frame OLD shown below and <code>new_data</code> equals
data.frame NEW, then the resulting, paired data.frame will look like PAIRED.</p>
<p></p><div class="sourceCode R"><pre><code><span><span class="va">OLD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    NAME   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>,  <span class="st">"B"</span>,  <span class="st">"C"</span>  <span class="op">)</span>,</span>
<span>    SMILES <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"CC"</span>, <span class="st">"CC"</span>, <span class="st">"CCC"</span><span class="op">)</span>,</span>
<span>    RT     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.0</span>,  <span class="fl">8.0</span>,  <span class="fl">8.2</span>,  <span class="fl">9.0</span> <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">NEW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    NAME   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>,  <span class="st">"B"</span>,  <span class="st">"B"</span><span class="op">)</span>,</span>
<span>    SMILES <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"CC"</span>, <span class="st">"CC"</span>, <span class="st">"CC"</span><span class="op">)</span>,</span>
<span>    RT     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,  <span class="fl">5.5</span>,  <span class="fl">5.7</span>,  <span class="fl">5.6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">PAIRED</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    NAME   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>,  <span class="st">"B"</span>,  <span class="st">"B"</span><span class="op">)</span>,</span>
<span>    SMILES <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"CC"</span>, <span class="st">"CC"</span>, <span class="st">"CC"</span><span class="op">)</span>,</span>
<span>    RT     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.0</span>,  <span class="fl">8.1</span>,  <span class="fl">8.1</span>,  <span class="fl">8.1</span><span class="op">)</span>, <span class="co"># Average of OLD$RT[2:3]</span></span>
<span>    RT_ADJ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,  <span class="fl">5.5</span>,  <span class="fl">5.7</span>,  <span class="fl">5.6</span><span class="op">)</span>  <span class="co"># Taken from NEW</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
<p>If <code>do_cv</code> is TRUE, the adjustment procedure is evaluated in
cross-validation. However, care must be taken when interpreting the CV
results, as the model performance depends on both the adjustment layer and
the original model, which was trained on the full base dataset. Therefore,
the observed CV metrics should be read as "expected performance when
predicting RTs for molecules that were part of the base-model training but
not part of the adjustment set" instead of "expected performance when
predicting RTs for completely new molecules".</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">frm</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_rp_lasso_model_rds.html">read_rp_lasso_model_rds</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_rpadj_xlsx.html">read_rpadj_xlsx</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">frm_adj</span> <span class="op">&lt;-</span> <span class="fu">adjust_frm</span><span class="op">(</span><span class="va">frm</span>, <span class="va">new_data</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tobias Schmidt, Christian Amesoeder, Marian Schoen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

